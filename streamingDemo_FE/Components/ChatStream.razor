
@using Microsoft.JSInterop
@inject IJSRuntime JS

<div class="chat">
    <textarea @bind="Prompt" placeholder="Scrivi il prompt..." disabled="@isStreaming"></textarea>
    <div style="margin-block: 12px;">
        <button @onclick="Start" disabled="@isStreaming">Invia</button>
        <button @onclick="Stop" disabled="@(!isStreaming)">Stop</button>
    </div>

    <div class="answer">
        @if (!string.IsNullOrEmpty(Output))
        {
            <p>@Output</p>
        }

        @if (_sources.Any())
        {
            <div class="sources">
                <strong>Fonti rilevanti:</strong>
                <ul>
                    @foreach (var source in _sources)
                    {
                        <li>📄 @source</li>
                    }
                </ul>
            </div>
        }

       
        @if (!string.IsNullOrEmpty(_tipsTitle) || _tipsItems.Any())
        {
            <div class="tips">
                <strong>@_tipsTitle</strong>
                <ul>
                    @foreach (var tip in _tipsItems)
                    {
                        <li>💡 @tip</li>
                    }
                </ul>
            </div>
        }

        @if (isStreaming)
        {
            <span class="cursor">▋</span>
        }
    </div>
</div>


@* CSS scoped opzionale *@
<style>
    :host {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    .chat {
        width: 100%;
    }

    textarea {
        width: 100%;
        min-height: 80px;
        resize: vertical;
        box-sizing: border-box; /* fondamentale */
        display: block; /* evita spazi/gap inline */
        max-width: 100%; /* cintura di sicurezza */
    }

    .answer {
        white-space: pre-wrap;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 1rem;
        min-height: 60px;
    }

    .sources, .tips {
        margin-top: 1rem;
        padding-top: 0.75rem;
        border-top: 1px solid #eee;
        font-size: 0.9rem;
    }

        .sources ul, .tips ul {
            margin: 0.25rem 0 0 0;
            padding-left: 1.25rem;
        }

    .cursor {
        display: inline-block;
        animation: blink 1s step-start infinite;
    }

    @@keyframes blink {
        50% {
            opacity: 0;
        }
    }
</style>